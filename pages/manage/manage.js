// pages/manage/manage.js

const db = wx.cloud.database({
  env: "tmassistant-5275ad"
})

Page({
  /**
   * 页面的初始数据
   */
  data: {

  },

  postMessage: function(e) {
    let formId = e.detail.formId
    let activityName = e.detail.value.activityName
    let activityLocation = e.detail.value.activityLocation
    let activityDesc = e.detail.value.activityDesc

    wx.cloud.callFunction({
      name: "broadcast",
      complete: res => {
        console.log("broadcast")
        console.log(res.result)

        console.log("https://api.weixin.qq.com/cgi-bin/message/wxopen/template/send?access_token=" + res.result)

        wx.request({
          url: "https://api.weixin.qq.com/cgi-bin/message/wxopen/template/send?access_token=" + res.result,
          header: {
            "Content-Type": "application/x-www-form-urlencoded"
          },
          method: "POST",
          //data: { cityname: "上海", key: "1430ec127e097e1113259c5e1be1ba70" },
          data: json2Form({ 
            touser: "oWbQf0esXoh89a77zkfhQqDJ1kvQ", 
            template_id: "bZ7b6ZkH0AiytbK8QmmdxNyIDP7yLJOV3AEMsf-bjE0",
            form_id: "cb5cb421ee65436034d2af5c4f5fab66",
            data: {
              "keyword1":{
                "value": "1111"
              },
              "keyword2": {
                "value": "2222"
              },
              "keyword3": {
                "value": "333"
              }
            }
          }),
          success: function (res) {
            console.log(res)
          },
          fail: function (res) {
            console.log(res)
          },
          complete: function (res) {
            console.log("complete::::::::::")
          }
        })
      }
    }),

    wx.navigateBack({})
  },

  //填入活动名称
  bindActivityName: function (e) {
    // console.log(e.detail.value)
  },

  //填入活动地址
  bindActivityLocation: function (e) {
    // console.log(e.detail.value)
  },

  //填入活动说明
  bindDesInput: function(e) {
    // console.log(e.detail.value)
  },

  // 清理前 17731 条 
  // 清理后 7573 条
  upFormIds: function(e) {
    var used = ['bcf8f84ca5a540bcba4061dfeb8c84d1', '39aa9055b42b4ded9118a0607af2ae70', 'c82c526a99f64a9382488b58d81cd041', '0c12bc573c864bbcbb16c81569855801', '3361bd4858e74c0f939f406d0a0895d4', 'ab6d8802dae54dfd90c2f86c8db078dd', 'c0a26dc7cf36418cb3a16aeb26cfe45e', 'd0eeeea511724a04bbc240e9ad299046', 'b71176c101f64c26950357d033faff86', '22bfb87e568248c7a3b595f99544ce6a', '656f0c8755b34e3cb0531f016d95af7f', 'c10625d71e064d129c5974d0da3c97e3', 'd21d253a8177433792a114c4a47c2396', 'b93366c1fe9d475e9191ebb30469b3c3', '3dd2ac6d5f864d30bba21f68c9a168b5', 'ae8773fd6ccd4b11a7fc404f6e07da80', '5355fd204e854b11a468d37ab6afdeac', '734ddfbd4ce74f28ad657d8cee879dd8', 'c8f7aaca135743b6a6edf70399179e54', '0d994c70e0ec4a2fb9db64070567f2ff', '02f110d9207042d6ba360815e167be47', '5f2d1346329e4546bf99967a1defbf20', '0d29949dc6bf4dff888c2f354da2cebc', 'd5f252f3b4df4446b4a5c5e907a8d8fe', '735d757d2ea14fb2bd8948eb76a58611', '5d4e7d28953c4aa69fc29de81aa7daac', 'f4733de1bc244281bf08ef2c2f4b4b48', 'dfa51d0a376e4284b004aa27d26a1c13', '4af14323abe1485f8046ff6c94d4fcc9', 'c0fd05efc8ea4604940472607bd3a07e', 'ae0ed4f5b3544a8596c6581346bc2c17', 'ebb11e296f2d42438225dc7092190242', 'a484e242795144468a57a9335069c9f0', '5f8e268028a942a7b5a0cde723104dfd', '8255ba0fc81d4535ae39b4a14bf4691b', '24bfabc738e9447ab37c8e5a57196af4', '12ba6bce1bb342eba02cd77416454bcd', 'd0bc6a1731f548b8bfdf251ec652d51b', '95a6b76c6d7f4d6c8489190de053a638', '2dcca8b41695468397bdfdefb45e0df5', '8796d1a9670b45899fd24d1c9aabc91b', '2eb2a6d3112b43509f10aa9159941a50', 'e89f27cb7f7b45fd9a533c227e4de288', '970ccccfd6d94d1d954d2281d15412c1', 'c45c753e774844079e1c04bf70f7697d', '5cd8f72bdf1141aca3b111e565040a2a', '01deb205f83d488ba9ed53a31f65be7b', '4386b134acf44eef9bb9a28d8e5c06fc', '6c01cbcd5339479b8a84fbb59055a31a', 'be8b3d604b874cd396a015f80b321554', '419180c2be2a4909a9cca7be9f14166f', '5520a77694334d159cc6192fcc52bc53', '87e82703586e401caeb0811b98bc0192', 'ff7686ee5d1f4332a6d09148985b0d77', 'd1106a6ab0880c674e02fd92fa97921e', '90710f293e3c7d3fee090efc55654506', '63835db365ab4bffa702421ceec16a08', '1557414998481', '6481b0ff887a4439ba9435c2e45e9e6e', '81be86fc42214681a36929268aa0f341', 'the formId is a mock one', 'the formId is a mock one', '0310687ce4944978bc425cca4ae4ddff', 'c37a07c4c0394e5f9e358565407a7b17', '4374f7c9ccce4cc699b2b4332b2dbc00', '676dc18adb7c4a48a0dfa568de44fff5', '794d307013a44abba0de44946bb57571', '59989ade8a194f3e913a5ecf8195b4b0', 'f8be62421f73447ab2cad71d666f9bf1', 'the formId is a mock one', '3afb5ab47cfc4f3fb960f7dc93634f08', '2db93e27c5fd42918ad7d7c904840df5', '596eb5c87206496c86c41823ee58728a', '15f7ca963e0445a3a94e28fdc14bac54', '972a4196fe1f459b84fe191195188463', '68dade70d92348bc80c95d517144753e', '6b7186f3d72e433286ad19de68b2148e', '4ef574154cf04553a3a74c8833bb954e', '1557463735999', 'f6ade66715b24a28a4396238762cb1ee', '38ebca02dd8f4550973ac86bc8853fb6', '7e2f5e7e73cb44eda811df76bd17b7d6', '64379a77950346d8ad9c6ba4a7c0b20f', 'a6e4913b3c714bf2816106b4cd8b8612', '9bc1da72a8b64fa6956cbbb438cf050f', 'd07f629adad345cabba057f24dd0b054', 'fd35723fb70749f19817fbebbae22059', '1598398ecc484076b35e428c2118c0d5', 'b84ffb3dc2c54b7a87e4e056a5f7439e', '0b3fe563ae644ffdba056d2585fcbf00', '3e37649a7f5b410ea7259168eed27d0b', 'c29041e7635047288cbf1bf18a795909', '3dc9e1f7553e4d4a92e31f9e5eb34ffc', '7f7039a2c16f4493b0959745618c4213', 'e1d789430c7349789daf2804b51b8deb', 'cd7d5043ee7c4aeb9c39f426c9f901d1', 'the formId is a mock one', '81f399960be64cc491c26e39aaa24307', '0090821109d34c4ab161aa813607b50d', 'd42336d617e6497299e0f83a8c26431f', '195615afb32142709831dcd270a798be', '140abc539e414c6abbbeb868f24e46e8', 'f4bca66aef8a4a53bbad0c139cb97039', '02628b1e18674dcbadb54f48f65b5230', 'b7d118d572d9b214840306a6ff312f5f', 'f1d74744a23a48fead53e02c7aa7b312', 'cd2eb2f8894844aba209ed98abf5523e', 'bd52f19c604b4e41b9197938d7a76a73', '5d3aed7dc1604caba4edf114ed79d3a2', 'df25ba1038f74a9290faa3e2452e8dd6', '36be035434474cbebf5261476b00ce5e', '8267f35e769942b9a88809f0b8aac467', 'c29a0489a488467a9f2c194314b155fc', 'b7798cfc1d524d0bbc9dc64fc74a60c4', 'f4feedf4ea694822812919ed5129b3e9', 'f3fa5571305a4594825a0a56f8a27fa9', '621c2f5af0b5403aac6fa2df235f7bc7', '7ee88eb89b75416882e02fc359d08ea0', '6151a3295fd8430dac07327bbd8bab3c', 'c2cc0bb4717d43e0a61941218aebcabc', '7f41c46722f542b1bf60793449f1bf80', '862889dc325a4f30af22febca4f14a63', '89e42394f46248d3b9a494f12fea1715', '85d9d53f304c20cd89d9da5ea1bf7faf', '2d4e38e4052a41f5a9f68cb98a1619f7', '4a7d4029b9f640e88f3b90463ea82782', 'f8c039c2052344adbc45d98ed4f77150', '33222d39475344e9b4f7a33f3d12dc84', '5a530041c5034966b84bac725c100edf', 'e08765518030422da7c70507c91b2053', '9fba3f442aa947509089cb3475ec462e', '68a0f3d10d80406789a3abf2276065bf', '7dd6915e5ee8498dba7ff6e128a75624', 'c44fbb75ba6b4237b651e9e0819be990', 'ff6268c0f40240a797a4e5fa9378516d', '1d71a169a9424f3686177f6253a2b78e', '13d0ecc095024caf977ca2decdcf83b2', '02f4833549c7427babe442c9fa6e20c1', '9e958165f5e04eb88dc0439ecdef5676', 'ff730e7956e64f93bf9ca9ee78d5b51a', 'f104474738c44eb18b7e3650a387a320', 'a063d4c42df44793a18a5df55632ad3d', 'b2f6329c319947a88b472e1ac0638a45', 'd940799a4caa4a128eb04d5a962ceb95', 'dd9332e557f04354a2598c051443ab03', 'ee35aa708490411ea6906e9077f3476f', '976356625ba2414fa280f01e35c95383', 'faa95734da3349c9b70da7841edfb1f1', '82154fd2260347249ac21b63c8197cf6', '64f0db05a74447e787532a72cf46d2c7', 'fd757406f90549acb24cf948fb5990fa', '5c336c21f9bb416fb540906aaca8b711', '9c0bceeb40df41d5babe54c5c3878285', 'e74823d8fd804d7b800b50c8339d0682', '15782b463e194959b671b0080cd761e5', '893744a3efef418db642f9d34777a150', '9c4d0ce4f6324cf488402ec05cf427bf', '2dcb051d8fe344a089eaf85fb131c2d3', 'ad692c8f1be444869f8172e8e26492ec', 'bb822d237eb1490b9fda82309add6cd6', '86fe2c9c7a2447b1864be64b1671f338', 'e522200e972148f7bb72e00874dbd7e9', '837c23797e2c4f1bb2dfe04ad165aa99', '1635c3d5dc7a4d05b207a27c2a5a153f', '5839be38d1454036802bbbd102aaab33', '132f9411e7be4a97bdde5808015e3bf7', '7689c3965b794e4cae70613ca83e5e2f', '35950f7a40344a3ebdb8c750e136ee5d', '7cf06f4ce9c347aa9d9026b842267e74', '4349a48acc734969a86ab538d87f5570', '041e807552f242c4bad3549557ab51ce', '7de877b643ce43af885ae5647207c6b7', '9585c3d44f65474686d1ca489ad5cc3c', 'fa1e7c87aac841ab98ff6f7e00dfdb90', 'f1bd0a3d6ca4455ea9351198c12474b8', '27e3ce31ebec4544b1b4ee9e5e10215f', '016d8cc84f7440fcb6ed8b5bf869be1b', '17ec0c67391f40dfb326ec13f476afb4', '885c8da036b94cd9b30b7b8c8fc83225', 'e177d47ddb1b4580af08244a0b132959', 'a38d82266ab041439d6c6755b3e141d5', '75d41bdc7fd44e95bd17d84211ec5e00', 'a212fad9d4034817835aad2b12bf08dd', '586a78fcbcf6481194cdfe472ff617ae', '736ebd681b9349ec8e2070db5568c8db', 'ce263f8fdee94c399acef4842d323d35', '37944a923a5529af67f5a1948d6634ab', '9478ea4ef8474e7fa0dcf4b28e052fdb', 'dcfa483bd70e460bade02ca94eb5b848', '81a0fed4968c4948b73c31303c8e81f7', '542415011bdc4d0ea56fd871ee103a0e', '9589e46a6def438d8899203657fdf48c', '5d03651fc2e412434bff8131cfe46725', 'a08d254aca0e4096a144bf6e767b8982', '0c62c0d3f27e4ac88845014a01e7cbe0', '54479804edd04ef0b5d797271572f23f', '54641363a9e84193b0c9ee61583f000c', 'a225b0f8c9fd4c85b1522c9d4f3f64c1', '4c457614ff894eb29794e929d0418413', '2583cd86176644e9b8b25acacd2efd5c', '20946217cb1d4a078265762620240967', '031c388524027065c81e7b80d28df3ab', '1557787370258', '6a04e9a7ca8243e5b10d67ab368d827f', '3968d9013acd4234bf1553986fb237ec', '4faeb78713c441709935e3a7b0392042', '64827272b6d34fdebc11063c379583e7', 'b88ea873db834b749c61bf21c40195fa', '00491a82399445dda31b4efe234f384e', '0c2adb59a0f34f6498bd4625dea4516b', 'b765b4c4743c4997a91635dda8b25c9d', '6acc125c7e8344cdbc68776057a78d03', 'c595c358fb4644e0ada175ded84e6fbf', 'af786187c867436c8c3a0e9c996f2d7b', 'a03eaed7075a4d81850f05ffee6dcaa8', '8f71f3f596d84f538c7fb8d5c38eb754', 'd7c34ffe40e14c649e97fc5277fa68e8', 'c264205840024d7fb143bb5f132cf4fc', '63045a4a0cb349c8b1a809f3528c04ac', 'cbc003b81fdc44ee84fa550b656e5820', '57d5875afafb44f3b4f708533216d24a', 'c7664cfb786a426a8e2483bea2f33897', '1174e45c3eab40a0bc1dfb196fcfdd5e', '98d905d9ff114dd69f986e4f4d9a8515', '1204a689879f47d1a9edc11139fa0bd4', 'eb36eaf2a8fb45dea47edeccf8ee423b', '07f8daea9fa34f5aaf81804de65f87d1', '33256ecdba50432d98d6c723ae3ecbac', '8775bcd438784c419e509a3d18889750', '87cf26b005064db9b4f210bc34b300bc', 'dcaf5afe19fb420395905f793defc676', '069ac3ca57524ba9b5f53f00f932e9c2', '1781b993b3564330a6591962edb2b089', 'e4b2f8f39aa0422f956c4479c4ada593', 'c88806aae6d74dc3b699aab319ef16f6', '1c11b208a91a429c9f272b39a0e28982', '911b21e720e34dbcae7c5fe956580b90', '982e28623125411ebad7791ff7ea0709', '6e0bf780495f439682c967d71266f03b', '54ee50209b344d7694bfe37520b95f18', 'dc5185d04a4a404ca707bcb22beafe05', '27e20712d30f43ba973093940fff3af8', 'c50a1f38266d4b8b90f6593f6b56ce68', '0f99bd235eda49f1a1d790b43f2958c0', '0000741d24e148cbbcf2a6d3a145607a', '1921d194c63341858e28256b998681aa', 'ccae7a088e564157a1b6c5915e56e692', '6ad6188979724f138b368d375292dd04', '87185c9786384839ae10210b93bfbbad', 'f4d68be9392248e0a999736ebff9506f', '3cf4f609b2d84cd7820be98de480d1f9', '8248a4641ddf487db4baec8eb8ac4642', '488cbce6b80a452e8c4d274829583f04', '50f2f637f6344a11b894fe1b5d5a0807', 'a30230b72e2f43aebc5b1d7769f639a1', '4e0c8c5f19c44af69914a3a0bee64477', 'c8ef42a2f237436d949c5d624bbfec5a', '3298e11ac8224fee9e9f9f7989e2bd0d', 'bb26e1cd2d6246afaa14c67592383cf0', 'a7823a32903549c5a123c0d30b06af96', 'd28de2a188744cbf85e3aa3a36e4c8cd', '759d74ba1bf64f698a435d8f1636e2d4', '8b037f54f2d64bc796564c993d63be8c', 'b969404c44a64c489947c985b5c453f4', 'd29077a247c7470095fa5bf3b47307f7', '0d249c6ed2ba493bafe5090db2757acc', '491916cbaa12432780bb8f8606e00977', '0cee4118f94f4bf58a29e3313849acc2', '9be434b3100a463893399200e4d4333c', 'dc779f93bda7471592df8206415f97cc', '8cf308c48c0f494b93ffbe9a025a8a3b', '36f9e9001f184c80be4424f0cdb7fbb9', 'fe7f1fcfb74242048744a575f8caa387', 'b5c4ce23cd94466388187fee07d7b582', 'd03d956168d3418792475bf5833b674d', '2e912e10a411476396cb19a0b6fcee91', '0131d523ee444babb89707632259d3a7', '0dde3f8280c245d080b4aad3312627ca', 'a60f51e2b5d447cc917e25d49b1f9d05', '00ef21df716b434284ab3c4e124a887a', '142fb8793c5b49cfb1bc3c8005804e4b', '730dbf8b28544f59b2bd7405a060dca8', '0e2f244873bc4011a677da4fbd87259e', '18b99562ff2f4fe9b38fbc8f4a23cf39', '28f4e8d980644ad199bfb98c91de06ff', 'b3ceb94cdcd64f8180cb4ca0cd11c951', '2350ba00b2914040bba4e49555a22a88', '9f3405799a3a465c9bbfd4d71ca31f2a', '020218d518de49878fd77dc1fb627984', '175e965546d746ecbca7f14c07284eb6', '01ae28b0a368443e92706bc8ba6cfa76', 'fd7eb1f63c7e4f45bdb8f8aef8ad9a5c', '9feb6505c07347e0a3c6a48304f27672', '3b827efca1b249dc9f93fef7e2a42339', '1af1c31a5f734881b074f69a19b99bd8', 'f3bcad881ef14098acf92847619e4d2a', 'dba29562cc6c41e7864e734d0b85f70b', 'f24c4519b831437e80fc5d9347fdc78c', '91c41ff065e04dab9cab9f8c041b1d5f', 'ea5e2cfe32b64caa842756a75d2c3783', 'e498f30a6c7b42fe817d4949c94edec1', '33cec6306add440c917f3a78696fa534', '257921999cc043898f6a255f51d75f1d', 'c772a8605a214a499c7d2dc9e43f27b1', '1cf7a56ef8fb4f74b17afc3c84ea10d4', '8e95a916b1c34ac498bdd7393d14a506', '999b5511e22a4907ba33e67d8b70f689', 'c22ef040f4f44eb19ba062fe761510f2', 'a9d77c39266c4da88bb1dff9d77dd98f', 'b653aac8a3cc4f5d9aae24c2006c96d9', 'd67c7b3dc8af45a587018add88897efe', 'fbdbde1c42ec4a189c5faf90c6d4c8ab', 'dac3ff5897964df79836b8d1528ee0d4', 'eb41ebd47fca43718ed2470f57e090be', '221dd0fd79a64d818f2658f2427fd85a', '5498fe15369346b990fd62c30671f9b6', 'e4b478d91a6448e29d047eccb31a24ea', '7b4e0f326ada4583837e8f1c8f60b9e7', '497e20fac63c4120a711982dfc55cc05', '43fdc32856a64cbdaf1a461707736776', '42afd3505e524f6590497a2d8f45e913', '18c08910a90d41358e9104249f17ef16', '7bc952f0ed004136a63b7980d87e8d95', 'eefb44b869db48938cdeedecf0348fb5', 'a3df58f34aed4cf58de026a00d3526e4', 'a769b1b0bcc5448aad22aa933542d849', '19f827a88a144952910bd518288a6147', '0327a7e6f7b5445d84fc7789d6e74e64', '6fbba526f289499b876dbf8abd4db742', '657a9a92303e4584aea7057129d03999', '9fd732581bdf465a8eb63232551d23ad', '97a1349a3ed84f918b325e4b603eb7ca', 'ce16996dba214a00b8067439975456cf', 'dc01c4de7c01497db0a73b9bdfd0c732', '19e3e786e1cd4320827160da65de47fd', '4ef06ccaee7748b891331410a94577e1', 'f18604d9fbee4b0f949e826407f08d75', 'a6b0ae4c1a814b0d8051294f1f1ecd2b', '0ddefc8a70a84cb6941fc6fc6b64430d', '7d7e6fbaeafd4a9ea35aef04a51ed125', '29143c06b8dd43dbaa19479db001d62b', '4240b970de594cfdada5d74b258446e9', '26110adc6cd34dab86eda4b31db4b713', 'd4aa2b990b854ed7838c85ba0de42871', '97a6369b258544a5aa383db78359c313', '48da5f084ca84041ae656fe4783f07ab', '0a6fe4ed88c241aa829e57f2187c8529', 'e80a268d7460435c87648387a83d4f92', '0b7ee8ace93a4a39b8942bbc228c0528', 'e40b5429ccfa4898b2cb1ac7e9569dd9', 'b6ae448a89154677852e979f4d7634a8', '4044a86f173a47b7b5b5afdb7bc8c567', 'c356c362005749528415c411908b84b9', '1826032928854ae2ace9a3c0bd53fb8e', 'c50ff93f894b4f7296581a6507431097', 'a0802af2b3cf49bc95d8563b74dbea78', '5d1a533b0489408097f2d87aaf321b60', '4092eb7618b245c1b3098e58edd726c9', '448aa145badc42539a22febabc77381a', '4a6ca0c5d0ba4c03be9e1070135b2ce7', 'd5b9fba9ebad425398b8f7c1edc0649e', 'bb0851e0e04c4cb9b7021d676faff323', '4eb4355f44804e638969d397aa18d2b5', '1557526544545', 'ea92ccc7b5ff49cfb5fb4f44327acb5d', '938f3935ee494f21b80d09c765f67e76', 'bbfc7a817a1a4b059f7e06511b6ca028', 'd0724e75c4c64616bb238637c6c62e8b', '8fa9198c78c04fbc87acb80b06911c38', '610d04f9aec24b10922da13369274a3e', '085774093235429c8692c7a21ab5f5a3', 'e9a6735f951a46948b0a5e35181453c0', 'a777b491fcd04567b2838c94345d61ac', '6dce45b5951247939e30d6c71c31eba7', '40c969ea8556445b9a54aaf13fc0547d', '470f6d184c454abaa2e3ca95ac993e71', '9615e7df81564f1899a573a67ed42d92', '78e77159b1414bb89e9e9b082c2faa09', 'bb8f5b1658fb4699ea21edd73080ad51', '1b9cfd28031146e4b19c54a5665345ad', '9d577795b0514a3798b5ed89ec2b8366', 'df96fe5082fb486d8d3ecfd2cbd20f78', '3aef6e047147487fb674511935c3d010', '86ebcb53773e4517926beac34825fd20', 'c22edf5eca9941728065022016f3c9a5', '97600164da2e47158288c3fed91a15a3', '927bc2fb9f66491f90ea36a32fd733c2', '6f4186b1e9a04346bed4fd78ef2a20e6']

    wx.cloud.callFunction({
      name: "upFormIds",
      data: {
        used: used
      },
      success: res => {
        console.log("upFormIds")
      }
    })
  },

  /**
   * 生命周期函数--监听页面加载
   */
  onLoad: function (options) {
    // wx.cloud.callFunction({
    //   name: "broadcast",
    //   complete: res => {
    //     console.log("broadcast")
    //     console.log(res.result)
    //   }
    // })
  },

  /**
   * 生命周期函数--监听页面初次渲染完成
   */
  onReady: function () {

  },

  /**
   * 生命周期函数--监听页面显示
   */
  onShow: function () {

  },

  /**
   * 生命周期函数--监听页面隐藏
   */
  onHide: function () {

  },

  /**
   * 生命周期函数--监听页面卸载
   */
  onUnload: function () {

  },

  /**
   * 页面相关事件处理函数--监听用户下拉动作
   */
  onPullDownRefresh: function () {

  },

  /**
   * 页面上拉触底事件的处理函数
   */
  onReachBottom: function () {

  },

  /**
   * 用户点击右上角分享
   */
  onShareAppMessage: function () {

  }
})


function json2Form(json) {
  var str = [];
  for (var p in json) {
    str.push(encodeURIComponent(p) + "=" + encodeURIComponent(json[p]));
  }
  return str.join("&")
}